!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){if("function"!=typeof e(document).on){if("function"!=typeof e(document).delegate)throw"jQuery 1.4.2 or higher is required by jquery.dirtyforms";e.fn.on=function(t,i,n,o){return e(this).delegate(i,t,n,o)}}e.extend({DirtyForms:{message:"You've made changes on this page which aren't saved. If you leave you will lose these changes.",title:"Are you sure you want to do that?",dirtyClass:"dirty",listeningClass:"dirtylisten",ignoreClass:"ignoredirty",choiceContinue:!1,helpers:[],dialog:{selector:"#facebox .content",fire:function(t,i){var n="<h1>"+i+"</h1><p>"+t+'</p><p><a href="#" class="ignoredirty button medium red continue">Continue</a><a href="#" class="ignoredirty button medium cancel">Stop</a>';e.facebox(n)},bind:function(){var t=function(t){return function(i){("keydown"!==i.type||"keydown"===i.type&&27===i.keyCode)&&(e(document).trigger("close.facebox"),t(i))}};e(document).bind("keydown.facebox",t(i.decidingCancel)),e("#facebox .cancel, #facebox .close, #facebox_overlay").click(t(i.decidingCancel)),e("#facebox .continue").click(t(i.decidingContinue))},stash:function(){var t=e("#facebox");return""===e.trim(t.html())||"block"!=t.css("display")?!1:e("#facebox .content").clone(!0)},refire:function(t,i){e.facebox(t)}},isDirty:function(){return e(":dirtylistening").dirtyForms("isDirty")},disable:function(){e("html").addClass(i.ignoreClass)},ignoreParentDocs:function(){i.watchParentDocs=!1},choiceCommit:function(t){i.deciding&&(e(document).trigger("choicecommit.dirtyforms"),i.choiceContinue?i.decidingContinue(t):i.decidingCancel(t),e(document).trigger("choicecommitAfter.dirtyforms"))},isDeciding:function(){return i.deciding},decidingContinue:function(t){m(),t.preventDefault(),i.dialogStash=!1,e(document).trigger("decidingcontinued.dirtyforms"),h(i.decidingEvent),i.deciding=i.currentForm=i.decidingEvent=!1},decidingCancel:function(t){t.preventDefault(),e(document).trigger("decidingcancelled.dirtyforms"),i.dialog!==!1&&i.dialogStash!==!1&&"function"==typeof i.dialog.refire&&i.dialog.refire(i.dialogStash.html(),t),e(document).trigger("decidingcancelledAfter.dirtyforms"),i.deciding=i.currentForm=i.decidingEvent=i.dialogStash=!1}}}),e.extend(e.expr[":"],{dirtylistening:function(t){return e(t).hasClass(i.listeningClass)},dirty:function(t){return e(t).hasClass(i.dirtyClass)}});var t={init:function(){c();var t="textarea,input:not([type='checkbox'],[type='radio'],[type='button'],[type='image'],[type='submit'],[type='reset'],[type='file'],[type='search'])",s=e(document.activeElement);return s.is(t)&&(i.focused.element=s,i.focused.value=s.val()),this.each(function(s){var c=e(this);c.is("form")&&c.addClass(i.listeningClass).on("focus change",t,r).on("change","input[type='checkbox'],input[type='radio'],select",o).on("click","input[type='reset']",n)})},isDirty:function(){var t=!1,n=this;return s()?(t=!0,!0):(this.each(function(n){return e(this).hasClass(i.dirtyClass)?(t=!0,!0):void 0}),e.each(i.helpers,function(e,i){return"isDirty"in i&&i.isDirty(n)?(t=!0,!0):"isNodeDirty"in i&&i.isNodeDirty(n)?(t=!0,!0):void 0}),t)},setDirty:function(){return this.each(function(t){e(this).addClass(i.dirtyClass).parents("form").addClass(i.dirtyClass)})},setClean:function(){return i.focused={element:!1,value:!1},this.each(function(t){var n=this,o=e(this);if(o.removeClass(i.dirtyClass),o.is("form"))o.find(":dirty").removeClass(i.dirtyClass);else{var r=o.parents("form");0===r.find(":dirty").length&&r.removeClass(i.dirtyClass)}e.each(i.helpers,function(e,t){"setClean"in t&&t.setClean(n)})})}};e.fn.dirtyForms=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("Method "+i+" does not exist on jQuery.dirtyForms"):t.init.apply(this,arguments)},e.fn.setDirty=function(){return this.dirtyForms("setDirty")},e.fn.isDirty=function(){return this.dirtyForms("isDirty")},e.fn.cleanDirty=function(){return this.dirtyForms("setClean")};var i=e.DirtyForms=e.extend({watchParentDocs:!0,exitBound:!1,formStash:!1,dialogStash:!1,deciding:!1,decidingEvent:!1,currentForm:!1,focused:{element:!1,value:!1}},e.DirtyForms),n=function(){e(this).parents("form").dirtyForms("setClean"),i.onFormCheck&&i.onFormCheck()},o=function(){y(e(this))||(e(this).dirtyForms("setDirty"),i.onFormCheck&&i.onFormCheck())},r=function(){var t=e(this);s()&&!y(t)&&(i.focused.element.dirtyForms("setDirty"),i.onFormCheck&&i.onFormCheck()),i.focused.element=t,i.focused.value=t.val()},s=function(){return i.focused.element&&i.focused.element.val()!==i.focused.value},c=function(){if(!i.exitBound){var t=top!==self;e(document).on("click","a[href]",a).on("submit","form",u),e(window).bind("beforeunload",f),i.watchParentDocs&&t&&(e(top.document).on("click","a[href]",a).on("submit","form",u),e(top.window).bind("beforeunload",f)),i.exitBound=!0}},d=function(){var t="";return e.each(i.helpers,function(e,i){"ignoreAnchorSelector"in i&&(t.length>0&&(t+=","),t+=i.ignoreAnchorSelector)}),t},a=function(t){e(this).is(d())||g(e(this))||l(t)},u=function(e){i.currentForm=this,l(e)},f=function(e){var t=l(e);return t&&i.doubleunloadfix!==!0&&(i.deciding=!1),i.doubleunloadfix=!0,setTimeout(function(){i.doubleunloadfix=!1},200),"string"==typeof t?(e=e||window.event,e&&(e.returnValue=t),t):void 0},l=function(t){var n=e(t.target),o=t.type;return t.isDefaultPrevented()?!1:"beforeunload"==o&&i.doubleunloadfix?(i.doubleunloadfix=!1,!1):y(n)?(m(),!1):i.deciding?!1:i.isDirty()?"submit"==o&&n.dirtyForms("isDirty")?(m(),!0):(e(document).trigger("defer.dirtyforms"),"beforeunload"==o?i.message:void(i.dialog&&(i.deciding=!0,i.decidingEvent=t,"function"==typeof i.dialog.stash&&(i.dialogStash=i.dialog.stash()),t.preventDefault(),t.stopImmediatePropagation(),i.formStash="string"==typeof i.dialog.selector&&n.is("form")&&n.parents(i.dialog.selector).length>0?n.clone(!0).hide():!1,i.dialog.fire(i.message,i.title),"function"==typeof i.dialog.bind&&i.dialog.bind()))):(m(),!1)},g=function(e){var t=e.attr("target");return"string"==typeof t?"_blank"===t.toLowerCase():!1},y=function(e){return e.closest("."+i.ignoreClass).length>0},m=function(){e(window).unbind("beforeunload",f),window.onbeforeunload=null,e(document).trigger("beforeunload.dirtyforms")},h=function(t){if(e(document).trigger("beforeRefire.dirtyforms").trigger("beforeunload.dirtyforms"),"click"===t.type){var n=new e.Event("click");if(e(t.target).trigger(n),!n.isDefaultPrevented()){var o=e(t.target).attr("href");return void(location.href=o)}}else{var r;i.formStash?(r=i.formStash,e("body").append(r)):r=e(t.target).closest("form"),r.trigger(t.type)}}});
//# sourceMappingURL=jquery.dirtyforms.min.js.map